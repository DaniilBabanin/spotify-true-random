const spotifyRandom=(()=>{const e="b61d28d1ed4c49e8ba5d2923ed367262",t="https://tomeraberba.ch/spotify-true-random",o=["playlist-read-private","playlist-read-collaborative","user-modify-playback-state","user-library-read","user-read-playback-state"],n="state",s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a=new SpotifyWebApi;let c,i;function r(){if(c&&i&&(new Date).getTime()<i)return c;const a=function(){const e={},t=/([^&;=]+)=?([^&;]*)/g,o=window.location.hash.substring(1);let n;for(;n=t.exec(o);)e[n[1]]=decodeURIComponent(n[2]);return e}();if(a.state&&a.access_token&&a.expires_in&&a.state===localStorage.getItem(n))return localStorage.removeItem(n),c=a.access_token,i=(new Date).getTime()+a.expires_in,window.location.hash="",c;!function(){const a=Array.apply(null,Array(16)).map(()=>s.charAt(Math.floor(Math.random()*s.length))).join("");localStorage.setItem(n,a),window.location.href="https://accounts.spotify.com/authorize?client_id="+encodeURIComponent(e)+"&response_type="+encodeURIComponent("token")+"&redirect_uri="+encodeURIComponent(t)+"&state="+encodeURIComponent(a)+"&scope="+encodeURIComponent(o.join(" "))}()}return{token:r,playlists:e=>{a.setAccessToken(r()),a.getUserPlaylists({limit:50},(t,o)=>e(o))},tracks:(e,t)=>{const o=e.split(":")[0],n=e.split(":")[1],s=e.split(":")[2];let c=0;const i=[];!function e(){a.setAccessToken(r()),a.getPlaylistTracks(o,n,{offset:c,limit:100,fields:"items(track(uri))"},(o,n)=>{n.items.map(e=>e.track.uri).forEach(e=>i.push(e)),(c+=100)<s?e():t(i)})}()},library:e=>{a.setAccessToken(r()),a.getMySavedTracks({limit:50},(t,o)=>{const n=o.total;let s=50;const c=o.items.map(e=>e.track.uri);!function t(){a.setAccessToken(r()),a.getMySavedTracks({offset:s,limit:50},(o,a)=>{a.items.map(e=>e.track.uri).forEach(e=>c.push(e)),(s+=50)<n?t():e(c)})}()})},devices:e=>{a.setAccessToken(r()),a.getMyDevices((t,o)=>e(o.devices.filter(e=>!e.is_restricted)))},play:e=>{const t=document.getElementById("devices-select").value;""!==t&&(!function(e){for(let t=e.length-1;t>0;t--){let o=Math.floor(Math.random()*(t+1));[e[t],e[o]]=[e[o],e[t]]}}(e),a.setAccessToken(r()),a.play({uris:e.slice(0,Math.min(385,e.length)),device_id:t}))},refresh:()=>{spotifyRandom.token()&&(spotifyRandom.playlists(e=>{const t=document.getElementById("playlists-select");for(let e=t.length-1;e>=0;e--)t.remove(e);e.items.forEach(e=>{const o=document.createElement("option");o.text=e.name,o.value=e.owner.id+":"+e.id+":"+e.tracks.total,t.add(o)})}),spotifyRandom.devices(e=>{const t=document.getElementById("devices-select");for(let e=t.length-1;e>=0;e--)t.remove(e);if(0===e.length){const e=document.createElement("option");e.text="Please Open Spotify",e.value="",t.add(e)}else e.forEach(e=>{const o=document.createElement("option");o.text=e.name,o.value=e.id,t.add(o)})}))}}})();document.addEventListener("DOMContentLoaded",()=>spotifyRandom.refresh());